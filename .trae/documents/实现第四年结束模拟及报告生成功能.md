# 实现第四年结束模拟及报告生成功能

## 需求分析

1. 模拟在第四年结束后结束
2. 结束后在运营流程界面根据存档内容生成报告
3. 报告格式类似于`运行控制表.csv`文件的表格格式

## 实现步骤

### 1. 修改企业状态类型，添加游戏结束标志

* 在`src/types/enterprise.ts`中添加`isGameOver`字段到`OperationData`接口

### 2. 更新企业状态管理

* 在`src/store/enterpriseStore.ts`的初始状态中添加`isGameOver: false`

* 在`nextQuarter`函数中添加结束条件判断：当年度为4且季度为4时，设置`isGameOver: true`

### 3. 实现报告生成功能

* 在`src/components/OperationCenter.tsx`中添加报告生成逻辑

* 根据存档内容生成符合`运行控制表.csv`格式的报告数据，分成四个表格，每个表格是一年。

* 添加报告显示表格，包含所有年度和季度的操作记录

### 4. 添加报告导出功能

* 实现CSV格式报告导出

* 按钮用于触发报告生成和下载

### 5. 更新运营流程界面

* 在游戏结束后显示报告内容

* 隐藏或禁用"进入下一季度"按钮

* 调整界面布局，突出显示报告

## 关键技术点

### 报告数据结构

```typescript
interface ReportRow {
  year: number;
  quarter: number;
  step: number;
  description: string;
  completed: boolean;
  // 其他相关数据
}
```

### 报告生成逻辑

1. 遍历所有年度和季度的操作记录
2. 对照`运行控制表.csv`的操作项进行匹配
3. 生成包含年份、季度、操作步骤、完成状态等信息的报告
4. 支持按年度和季度分组显示

### 游戏结束判断

```typescript
if (newYear > 4) {
  // 设置游戏结束状态
  set(state => ({
    ...state,
    state: {
      ...state.state,
      operation: {
        ...state.state.operation,
        isGameOver: true
      }
    }
  }));
}
```

## 文件修改清单

1. `src/types/enterprise.ts` - 添加游戏结束标志
2. `src/store/enterpriseStore.ts` - 添加游戏结束逻辑
3. `src/components/OperationCenter.tsx` - 添加报告生成和显示功能

## 预期效果

* 游戏在第四年结束后自动停止

* 运营流程界面显示完整的运营报告

* 支持导出CSV格式报告

* 界面布局清晰，突出显示报告内容

